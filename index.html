<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dispatch</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body { margin:0; }
#map { height:100vh; }
</style>
</head>
<body>

<div id="map"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAQy51BTmMziVId21F3a4DRebFd7Ni_Jcs",
  authDomain: "phone-tracker-f5a92.firebaseapp.com",
  databaseURL: "https://phone-tracker-f5a92-default-rtdb.firebaseio.com",
  projectId: "phone-tracker-f5a92",
  storageBucket: "phone-tracker-f5a92.firebasestorage.app",
  messagingSenderId: "778164059316",
  appId: "1:778164059316:web:ad01f560d82a58491e2be1",
  measurementId: "G-9N8F2JEWD0"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const map = L.map('map').setView([44,-90], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

const markers = {};

db.ref("drivers").on("value", snap => {
  snap.forEach(child => {
    const d = child.val();
    if (!markers[child.key]) {
      markers[child.key] = L.marker([d.lat, d.lon]).addTo(map);
    }
    markers[child.key].setLatLng([d.lat, d.lon])
      .bindPopup(`
        <b>${d.name}</b><br>
        Speed: ${(d.speed*2.23694).toFixed(1)} mph<br>
        Updated: ${new Date(d.time).toLocaleTimeString()}
      `);
  });
});
</script>

</body>

</html>
